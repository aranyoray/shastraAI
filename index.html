<!DOCTYPE html>
<html>
<head>
    <title>ShastraAI - Legal Document Analysis</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        input, textarea, button { width: 100%; padding: 10px; margin: 5px 0; }
        button { background: #007bff; color: white; border: none; cursor: pointer; }
        .result { background: #f8f9fa; padding: 15px; border-radius: 3px; margin-top: 10px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <div style="text-align: center; margin-bottom: 30px;">
        <img src="shastraAI_logo.png" alt="ShastraAI Logo" style="max-width: 200px; height: auto; display: block; margin: 0 auto 20px auto;">
        <h1>ShastraAI - Legal Document Analysis</h1>
    </div>
    
    <div class="section">
        <h3>Upload Document</h3>
        <input type="file" id="fileInput" accept=".pdf,.docx">
        <input type="text" id="docId" placeholder="Document ID" value="demo-doc">
        <button onclick="upload()">Upload & Process</button>
        <div id="uploadResult" class="result"></div>
    </div>

    <div class="section">
        <h3>Extract Info</h3>
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
            <button onclick="extractEntities()" style="background: #28a745; flex: 1;">Entities</button>
            <button onclick="extractAmounts()" style="background: #28a745; flex: 1;">Amounts</button>
            <button onclick="extractDates()" style="background: #28a745; flex: 1;">Dates</button>
            <button onclick="extractDeadlines()" style="background: #28a745; flex: 1;">Deadlines</button>
        </div>
        <div id="entitiesResult" class="result">Click any button to extract information from your document.</div>
    </div>

    <div class="section">
        <h3>Ask Questions</h3>
        <div style="margin-bottom: 10px;">
            <label for="languageSelect">Language: </label>
            <select id="languageSelect" onchange="changeLanguage()" style="padding: 5px; margin-left: 10px;">
                <option value="en">English</option>
                <option value="hi">Hindi (हिंदी)</option>
                <option value="bn">Bengali (বাংলা)</option>
                <option value="es">Spanish (Español)</option>
                <option value="fr">French (Français)</option>
                <option value="de">German (Deutsch)</option>
                <option value="ja">Japanese (日本語)</option>
                <option value="ko">Korean (한국어)</option>
                <option value="zh">Chinese (中文)</option>
            </select>
        </div>
        <textarea id="question" placeholder="Ask a question about the document...">What is the rent amount?</textarea>
        <button onclick="askQuestion()">Ask Question</button>
        <div id="answerResult" class="result">Ask a question to get an AI-powered answer.</div>
    </div>

    <script>
        window.onload = function() {
            fetch('/api')
                .then(response => response.json())
                .then(data => console.log('API Test Success:', data))
                .catch(error => console.error('API Test Error:', error));
        };

        async function upload() {
            const file = document.getElementById('fileInput').files[0];
            const docId = document.getElementById('docId').value || 'demo-doc';
            
            if (!file) {
                showResult('uploadResult', 'Please select a file first!', 'error');
                return;
            }

            showResult('uploadResult', 'Processing document...', 'success');

            try {
                const formData = new FormData();
                formData.append('file', file);
                formData.append('doc_id', docId);
                formData.append('action', 'ingest');

                const response = await fetch('/api', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('uploadResult', 
                        `Document processed successfully!\n\nExtracted ${data.chunks} chunks\nFound ${data.entities.parties.length} parties, ${data.entities.amounts.length} amounts, ${data.entities.dates.length} dates`, 
                        'success'
                    );
                } else {
                    showResult('uploadResult', 'Error: ' + data.error, 'error');
                }
            } catch (error) {
                showResult('uploadResult', 'Error: ' + error.message, 'error');
            }
        }

        async function extractEntities() {
            const docId = document.getElementById('docId').value || 'demo-doc';
            showResult('entitiesResult', 'Extracting entities...', 'success');

            try {
                const response = await fetch('/api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'entities', doc_id: docId })
                });
                
                const entities = await response.json();
                
                if (response.ok) {
                    const result = `EXTRACTED ENTITIES

PARTIES:
${entities.parties.map(p => `• ${p}`).join('\n')}

MONETARY AMOUNTS:
${entities.amounts.map(a => `• ${a}`).join('\n')}

DATES & DEADLINES:
${entities.dates.map(d => `• ${d}`).join('\n')}

KEY TERMS:
${entities.terms.map(t => `• ${t}`).join('\n')}`;
                    
                    showResult('entitiesResult', result, 'success');
                } else {
                    showResult('entitiesResult', 'Error: ' + entities.error, 'error');
                }
            } catch (error) {
                showResult('entitiesResult', 'Error: ' + error.message, 'error');
            }
        }

        async function askQuestion() {
            const question = document.getElementById('question').value;
            const docId = document.getElementById('docId').value || 'demo-doc';
            
            if (!question.trim()) {
                showResult('answerResult', 'Please enter a question!', 'error');
                return;
            }

            showResult('answerResult', 'Thinking...', 'success');

            try {
                const response = await fetch('/api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'ask', doc_id: docId, q: question })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('answerResult', data.answer, 'success');
                } else {
                    showResult('answerResult', 'Error: ' + data.error, 'error');
                }
            } catch (error) {
                showResult('answerResult', 'Error: ' + error.message, 'error');
            }
        }

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.textContent = message;
            element.className = 'result ' + (type || '');
        }

        async function extractAmounts() {
            const docId = document.getElementById('docId').value || 'demo-doc';
            showResult('entitiesResult', 'Extracting amounts...', 'success');

            try {
                const response = await fetch('/api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'ask', doc_id: docId, q: 'List all monetary amounts, prices, fees, and financial figures mentioned in this document. Include currency symbols and context.' })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('entitiesResult', `MONETARY AMOUNTS FOUND:\n\n${data.answer}`, 'success');
                } else {
                    showResult('entitiesResult', 'Error: ' + data.error, 'error');
                }
            } catch (error) {
                showResult('entitiesResult', 'Error: ' + error.message, 'error');
            }
        }

        async function extractDates() {
            const docId = document.getElementById('docId').value || 'demo-doc';
            showResult('entitiesResult', 'Extracting dates...', 'success');

            try {
                const response = await fetch('/api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'ask', doc_id: docId, q: 'List all important dates mentioned in this document including start dates, end dates, deadlines, and any time-sensitive information.' })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('entitiesResult', `IMPORTANT DATES FOUND:\n\n${data.answer}`, 'success');
                } else {
                    showResult('entitiesResult', 'Error: ' + data.error, 'error');
                }
            } catch (error) {
                showResult('entitiesResult', 'Error: ' + error.message, 'error');
            }
        }

        async function extractDeadlines() {
            const docId = document.getElementById('docId').value || 'demo-doc';
            showResult('entitiesResult', 'Extracting deadlines...', 'success');

            try {
                const response = await fetch('/api', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'ask', doc_id: docId, q: 'Extract all critical deadlines, due dates, expiration dates, and time-sensitive obligations from this document. Focus on actionable deadlines.' })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showResult('entitiesResult', `CRITICAL DEADLINES FOUND:\n\n${data.answer}`, 'success');
                } else {
                    showResult('entitiesResult', 'Error: ' + data.error, 'error');
                }
            } catch (error) {
                showResult('entitiesResult', 'Error: ' + error.message, 'error');
            }
        }

        function changeLanguage() {
            const language = document.getElementById('languageSelect').value;
            const question = document.getElementById('question');
            
            const translations = {
                en: "What is the rent amount?",
                hi: "किराये की राशि क्या है?",
                bn: "ভাড়ার পরিমাণ কত?",
                es: "¿Cuál es el monto del alquiler?",
                fr: "Quel est le montant du loyer?",
                de: "Wie hoch ist die Miete?",
                ja: "家賃はいくらですか？",
                ko: "임대료는 얼마인가요?",
                zh: "租金是多少？"
            };
            
            question.placeholder = translations[language] || translations.en;
        }
    </script>
</body>
</html>
